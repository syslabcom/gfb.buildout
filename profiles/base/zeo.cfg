[buildout]
extends = base.cfg
zeo-parts = zodb zodb-patches zeo zeo-cron zeo-pack zeo-logrotate

[versions]
ZODB3 = 3.10.0b4
zc.lockfile = 1.0.0
transaction = 1.1.0
zope.event = 3.5.0-1

[zodb-patches]
recipe = collective.recipe.patch
egg = ${zodb:eggs}
patches = ${buildout:directory}/patches/py24py25exceptions.patch
patch-binary = patch

[zodb]
recipe = zc.recipe.egg:script
eggs = ZODB3
unzip = true

[zeo]
recipe = zc.zodbrecipes:server
eggs = plone.app.blob
zeo.conf =
    <zeo>
        address ${settings:zeo-address}
        transaction-timeout 300
        invalidation-queue-size 10000
    </zeo>
    <filestorage 1> 
        path ${database:path}
        blob-dir ${database:location}/blobs
    </filestorage>
    <filestorage 2>
        path ${root-database:path}
        blob-dir ${root-database:location}/blobs
    </filestorage>

[zeo-cron]
recipe = z3c.recipe.usercrontab
times = @reboot
command = ${buildout:directory}/etc/init.d/osha-zeo start |& logger -t zeo

[zeo-pack]
recipe = z3c.recipe.usercrontab
times = 35 2 * * 6
command = ${buildout:bin-directory}/zeopack ${settings:zeo-address} |& logger -t zeo

[zeo-logrotate]
recipe = collective.recipe.template
input = profiles/base/templates/zeo.logrotate
output = ${buildout:directory}/logrotate.d/zeo
